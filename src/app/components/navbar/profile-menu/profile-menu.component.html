<hlm-dialog>
  <button [brnMenuTriggerFor]="menu">
    @if (currentUser$ | async; as currentUser) {
    <hlm-avatar>
      <img [src]="currentUser.photoURL" alt="Profile picture" hlmAvatarImage />
      <span class="{{ getBackgroundColor(currentUser.displayName) }} text-white" hlmAvatarFallback>{{ getFallback(currentUser.displayName) }}</span>
    </hlm-avatar>
    } @else {
      <hlm-skeleton class="w-11 h-11 rounded-full" />
    }
  </button>

  <ng-template #menu>
    <hlm-menu class="w-64">
      <hlm-menu-label>
        <div class="flex flex-col items-center gap-3">
          @if (currentUser$ | async; as currentUser) {
          <hlm-avatar variant="medium">
            <img
              [src]="currentUser.photoURL"
              alt="Profile picture"
              hlmAvatarImage
            />
            <span class="bg-[#FD005B] text-white" hlmAvatarFallback>{{
              label
            }}</span>
          </hlm-avatar>

          <div>
            <p class="text-foreground text-base font-medium text-center">
              {{ currentUser.displayName }}
            </p>
            <p class="text-muted-foreground text-sm font-medium text-center">
              {{ currentUser.email }}
            </p>
          </div>
          } @else {
            <hlm-skeleton class="w-14 h-14 rounded-full" />
            
            <div class="flex flex-col items-center gap-2">
              <hlm-skeleton class="w-36 h-4 rounded-md" />
              <hlm-skeleton class="w-52 h-4 rounded-md" />
            </div>
          }
        </div>
      </hlm-menu-label>

      <hlm-menu-separator />

      <hlm-menu-group>
        <button hlmMenuItem>
          <a
            routerLink="/account"
            class="flex items-center w-full h-full text-start"
          >
            <span>Mi perfil</span>
          </a>
        </button>

        <button hlmMenuItem>
          <a
            routerLink="/settings"
            class="flex items-center w-full h-full text-start"
          >
            <span>Configuraci√≥n</span>
          </a>
        </button>

        <button hlmMenuItem>
          <!-- <app-change-language /> -->
          <button
            id="change-language"
            brnDialogTrigger
            hlmBtn
            class="flex items-center gap-3"
          >
            <span>Cambiar idioma</span>
            <img [src]="currentLanguage.image" alt="flag" class="w-5" />
          </button>
          
          <hlm-dialog-content *brnDialogContent="let ctx">
            <hlm-dialog-header>
              <h3 hlmDialogTitle>Elige el idioma:</h3>
            </hlm-dialog-header>
            <div class="flex items-center gap-5">
              @for (language of languages; track $index) {
                <button
                  class="flex items-center gap-2 border rounded-xl px-5 py-3 text-sm capitalize hover:border-[#999]"
                  [ngClass]="currentLanguage.code === language.code ? 'border-primary' : 'border-border'"
                  (click)="onChangeLanguage(ctx, language.code, language.image)"
                >
                  {{ language.name }}
                  <img [src]="language.image" alt="flag" class="w-7" />
                </button>
              }
            </div>
          </hlm-dialog-content>
        </button>
      </hlm-menu-group>

      <hlm-menu-separator />

      <hlm-menu-group>
        <button hlmMenuItem (click)="onLogout()">
          <span>Cerrar sesion</span>
        </button>
      </hlm-menu-group>
    </hlm-menu>
  </ng-template>
</hlm-dialog>
